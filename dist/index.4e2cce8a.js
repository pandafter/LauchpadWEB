class e{constructor(){this.midiInput=null,this.midiOutput=null,this.pads=new Map,this.selectedPad=null,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.activeAudioSources=new Map,this.keyToPadMap={q:"0-0",w:"0-1",e:"0-2",r:"0-3",t:"0-4",y:"0-5",u:"0-6",i:"0-7",a:"1-0",s:"1-1",d:"1-2",f:"1-3",g:"1-4",h:"1-5",j:"1-6",k:"1-7",z:"2-0",x:"2-1",c:"2-2",v:"2-3",b:"2-4",n:"2-5",m:"2-6",",":"2-7",1:"7-5",2:"7-6",3:"7-7",4:"6-5",5:"6-6",6:"6-7",7:"5-5",8:"5-6",9:"5-7"},this.init()}init(){this.createGrid(),this.setupEventListeners(),this.setupMIDI(),this.setupContextMenu()}createGrid(){let e=document.getElementById("launchpadGrid");for(let t=0;t<8;t++)for(let i=0;i<8;i++){let a=document.createElement("div");a.className="pad",a.id=`${t}-${i}`,a.style.backgroundColor="#333";let o=document.createElement("div");o.className="pad-status",a.appendChild(o);let n=`${t}-${i}`;this.pads.set(n,{element:a,color:"#333",audioBuffer:null,isPlaying:!1,statusIcon:o,imageBuffer:null,hasImage:!1}),a.addEventListener("click",()=>this.handlePadClick(n)),a.addEventListener("contextmenu",e=>this.showContextMenu(e,n)),e.appendChild(a)}}setupContextMenu(){document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("click",()=>{let e=document.querySelector(".context-menu");e&&e.remove()})}showContextMenu(e,t){e.preventDefault();let i=document.querySelector(".context-menu");i&&i.remove();let a=document.createElement("div");a.className="context-menu";let o=this.pads.get(t),n=[{text:"Cargar Audio",action:()=>this.loadAudioFile(t)},{text:"Cambiar Color",action:()=>this.showColorPicker(t)},{text:"Cambiar Imagen",action:()=>this.loadImageFile(t)}];o.soundInfo&&n.unshift({text:`Sonido: ${o.soundInfo.name}`,action:()=>{},className:"info"}),o.audioBuffer&&n.push({text:"Eliminar Audio",action:()=>this.removeAudio(t),className:"danger text-danger"}),o.hasImage&&n.push({text:"Eliminar Imagen",action:()=>this.removeImage(t),className:"danger text-danger"}),n.forEach(e=>{let t=document.createElement("div");t.className="context-menu-item"+(e.className?" "+e.className:""),t.textContent=e.text,t.onclick=()=>{e.action(),a.remove()},a.appendChild(t)}),document.body.appendChild(a);let s=a.getBoundingClientRect(),d=window.innerWidth,l=window.innerHeight,c=e.clientX,u=e.clientY;c+s.width>d&&(c=d-s.width-10),u+s.height>l&&(u=l-s.height-10),c=Math.max(10,c),u=Math.max(10,u),a.style.left=`${c}px`,a.style.top=`${u}px`}showColorPicker(e){let t=document.createElement("div");t.className="modal-overlay";let i=document.createElement("div");i.className="color-picker-modal";let a=document.createElement("input");a.type="color",a.value=this.pads.get(e).color;let o=document.createElement("button"),n=document.createElement("button");o.textContent="Aplicar",o.onclick=()=>{this.setPadColor(e,a.value),t.remove()},n.textContent="Reiniciar",n.onclick=()=>{this.setPadColor(e,"#333"),t.remove()},i.appendChild(a),i.appendChild(o),i.appendChild(n),t.appendChild(i),document.body.appendChild(t)}async setupMIDI(){try{if(navigator.requestMIDIAccess){let e=await navigator.requestMIDIAccess();document.getElementById("connectMIDI").addEventListener("click",()=>{this.connectToLaunchpad(e)})}}catch(e){console.error("Error al acceder a MIDI:",e),document.getElementById("midiStatus").textContent="Error: MIDI no soportado"}}connectToLaunchpad(e){for(let t of e.inputs.values())if(t.name.includes("Launchpad")){this.midiInput=t,this.midiInput.onmidimessage=e=>this.handleMIDIMessage(e),document.getElementById("midiStatus").textContent="Estado MIDI: Conectado a "+t.name;break}for(let t of e.outputs.values())if(t.name.includes("Launchpad")){this.midiOutput=t;break}}handleMIDIMessage(e){let[t,i,a]=e.data;if(144===t){let e=Math.floor(i/16),t=`${e}-${i%16}`;this.pads.has(t)&&this.triggerPad(t)}}setupEventListeners(){document.addEventListener("keydown",e=>{"Space"===e.code&&(e.preventDefault(),this.stopAllAudio());let t=this.keyToPadMap[e.key.toLocaleLowerCase()];t&&(e.preventDefault(),this.triggerPad(t))})}handlePadClick(e){this.selectedPad=e,this.triggerPad(e)}triggerPad(e){let t=this.pads.get(e);t.audioBuffer&&(t.isPlaying?this.stopAudio(e):this.playAudio(e));let i=t.color;t.element.style.backgroundColor="#fff",setTimeout(()=>{t.element.style.backgroundColor=i},100)}removeAudio(e){let t=this.pads.get(e);t.isPlaying&&this.stopAudio(e),t.audioBuffer=null,t.element.style.border="2px solid #333",t.statusIcon.textContent=""}removeImage(e){let t=document.getElementById(e),i=this.pads.get(e),a=t.querySelector("img.pad-image");a&&(i.imageBuffer&&URL.revokeObjectURL(i.imageBuffer),a.remove(),i.hasImage=!1,i.imageBuffer=null)}async loadAudioFile(e){let t=document.createElement("input");t.type="file",t.accept="audio/*",t.onchange=async t=>{let i=t.target.files[0],a=await i.arrayBuffer(),o=await this.audioContext.decodeAudioData(a),n=this.pads.get(e);n.audioBuffer=o,n.element.style.border="2px solid #4CAF50"},t.click()}async loadImageFile(e){let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async t=>{let i=t.target.files[0];if(i){let t=URL.createObjectURL(i),a=document.getElementById(e),o=this.pads.get(e);if(a){let e=a.querySelector("img");e||(e=document.createElement("img"),a.appendChild(e)),e.src=t,e.style.width="100%",e.style.height="100%",e.classList.add("pad-image"),o.hasImage=!0,o.imageBuffer=t}}},t.click()}setPadColor(e,t){let i=this.pads.get(e);if(i.color=t,i.element.style.backgroundColor=t,this.midiOutput){let[i,a]=e.split("-").map(Number),[o,n,s]=this.hexToRgb(t),d=Math.floor((o+n+s)/3*127/255);this.midiOutput.send([144,16*i+a,d])}}hexToRgb(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]}playAudio(e){let t=this.pads.get(e);t.isPlaying&&this.stopAudio(e);let i=this.audioContext.createBufferSource();i.buffer=t.audioBuffer,i.connect(this.audioContext.destination),i.start(),t.isPlaying=!0,t.statusIcon.textContent="⏸",i.onended=()=>{t.isPlaying=!1,t.statusIcon.textContent="",this.activeAudioSources.delete(e)},this.activeAudioSources.set(e,i)}stopAudio(e){let t=this.activeAudioSources.get(e),i=this.pads.get(e);t&&(t.stop(),this.activeAudioSources.delete(e)),i.isPlaying=!1,i.statusIcon.textContent="⏸"}stopAllAudio(){for(let[e]of this.activeAudioSources)this.stopAudio(e)}}window.addEventListener("DOMContentLoaded",()=>{new e}),window.onload=function(){!function(){let e=[],t=0,i=7,a=0,o=7;for(;t<=i&&a<=o;){for(let o=t;o<=i;o++)e.push(`${a}-${o}`);a++;for(let t=a;t<=o;t++)e.push(`${t}-${i}`);i--;for(let a=i;a>=t;a--)e.push(`${o}-${a}`);o--;for(let i=o;i>=a;i--)e.push(`${i}-${t}`);t++}e.forEach((e,t)=>{setTimeout(()=>{let t=document.getElementById(e);t&&(t.style.backgroundColor="#4caf50",setTimeout(()=>{t.style.backgroundColor="#333"},200))},100*t)})}()};
//# sourceMappingURL=index.4e2cce8a.js.map
